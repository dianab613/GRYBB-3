<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
<head>
  <link rel="stylesheet" href="signupform.css">
  <title> Signup Form </title>
</head>
<body>
<img src="logo.png" alt="Grybb Logo">
<div class="banner-text">
  <p style="line-height:200%; text-align: center; font-size: 150%; color: #414042;  font-family: Tahoma, sans-serif;	">
    <b> Create an account </b></p>
  <form target="useless">
    <input style="margin-top:-3%" type="text" placeholder="First Name" name="fname" id="fname" required>
    <br><br>
    <input type="text" placeholder="Last Name" name="lname"  id="lname" required>
    <br><br>
    <input type="text" placeholder="Email (username)" name="uname" id="uname" required>
    <br><br>
    <input id="myInput" type="password" placeholder="Password" name="psw" id="psw" required>
    <br><br>
    <input type="text" placeholder="Phone number" name="phone_no" id="phone_no" required>
    <br><br>
    <button class="showpsw" type="button" onclick="showpass()">Show Password</button>

    <script>
      function showpass() {
        var x = document.getElementById("myInput");
        if (x.type == "password") {
          x.type = "text";
        } else {
          x.type = "password";
        }
      }

      function createAcc() {
        alert("1");
        let xmlhttpPost = new XMLHttpRequest();
        xmlhttpPost.onreadystatechange = function () {

          if (this.readyState === 4 && this.status === 200) {
             if (this.response === true) {
            alert("2");
            window.location.replace("/loginportal.html")
              }
          }
        }
        alert("3");
        xmlhttpPost.open("POST", "/rest/signupform/add", true);
        xmlhttpPost.setRequestHeader("Content-type", "application/json");
        alert("4");
        let uname = document.getElementById("uname");
        let fname = document.getElementById("fname");
        let lname = document.getElementById("lname");
        let name = fname.value + " " + lname.value;
        let psw = document.getElementById("psw");
        let phone_no = document.getElementById("phone_no");
        let role;
        alert("5");
        if (uname.values().contains("@employee.com")) {
           role = "Field Engineer";
        } else if (uname.contains("@municipality.com")){
          role = "Municipality";
        } else if(uname.contains("@manager.com")){
         role = "Manager";
         }
          let jsonText = {
            "name" : name,
            "uname" : uname.value,
            "psw" : psw.value,
            "role" : role.value,
            "phone_no" : phone_no.value
          }
        alert(jsonText);
          xmlhttpPost.send(JSON.stringify(jsonText));
      }
    </script>
    <br>
    <br>
    <button class="cnlbutton" onclick="document.location= 'loginportal.html'">Cancel </button>
    <button type="submit" onclick="createAcc()">Create</button>

  </form>

</div>
</body>
</html>